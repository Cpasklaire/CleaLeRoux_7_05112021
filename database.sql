Create database groupomania;

use groupomania;

CREATE TABLE Users (
    id INT NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    lastName VARCHAR(50) NOT NULL,
    firstName VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,

    avatar VARCHAR(200),
    description LONGTEXT,

    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    lastRefreshDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE Posts (
    id INTEGER NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    userId INTEGER NOT NULL,
    
    text LONGTEXT,
    imageURL VARCHAR(200),
    
    likes INTEGER DEFAULT 0,
    
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE Likes (
    id INTEGER NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    postId INTEGER NOT NULL UNIQUE,
    userId INTEGER NOT NULL UNIQUE,		
    		
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE Commentaires (
    id INTEGER NOT NULL AUTO_INCREMENT UNIQUE PRIMARY KEY,
    postId INTEGER NOT NULL UNIQUE,
    userId INTEGER NOT NULL,
    
    text LONGTEXT,
    
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

show tables;

ALTER TABLE Posts
ADD FOREIGN KEY (userId) REFERENCES Users(id)
ON DELETE CASCADE,
ADD FOREIGN KEY (likes) REFERENCES Likes(id)
ON DELETE CASCADE;

ALTER TABLE Likes
ADD FOREIGN KEY (postId) REFERENCES Posts(id)
ON DELETE CASCADE,
ADD FOREIGN KEY (userId) REFERENCES Users(id)
ON DELETE CASCADE;

ALTER TABLE Commentaires
ADD FOREIGN KEY (postId) REFERENCES Posts(id)
ON DELETE CASCADE,
ADD FOREIGN KEY (userId) REFERENCES Users(id)
ON DELETE CASCADE;